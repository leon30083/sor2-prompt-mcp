## 有效的sora2视频指令格式
   {
      "shot_id": "shot_01_xiao_tuan_realization",
      "description": "【剧情开端】近景特写汤小团，他突然意识到什么，表情惊恐。",
      "api_call": {
        "seconds": "4",
      },
      "cinematography": "Medium close-up (MCU) on '汤小团', shallow depth of field, torchlight reflection in eyes.",
      "performance": "Eyes widen in sudden realization, face shows panic, whispers urgently.",
      "dialogue": {
        "character": "汤小团",
        "line": "我们又穿越了...孟虎, 你这乌鸦嘴!",
        "tone": "rapid, hushed, urgent"
      }
    },
    { 
      "shot_id": "shot_02_meng_hu_complaint",
      "description": "中景跟随拍摄孟虎，他哭丧着脸，一手揉着被硌得生疼的屁股。",
      "api_call": {
        "seconds": "4",
      },
      "cinematography": "Medium shot, tracking '孟虎', handheld shaky motion.",
      "performance": "His face is a picture of misery (crying face), he rubs his sore backside, complaining.",
      "dialogue": {
        "character": "孟虎",
        "line": "这体验也太真实了吧...差评!",
        "tone": "whining, complaining"
      }
    },


## 用户输入的原始信息:
 汤小团瞬间反应过来，压低声音道，“我们又穿越了！孟虎，你这乌鸦嘴，刚还在博物馆说想看看真的古代战场长什么样！”

“我哪知道摸一下锅的碎片，就能买到‘沉浸式体验’的VIP站票啊！” 孟虎哭丧着脸，揉着被硌得生疼的屁股，“这体验也太真实了吧？连个新手教程都没有！差评！”

---
## 需求：
设计一个智能体，能够根据用户输入的原始信息，生成符合要求的sora2视频指令。可以是llm提示词，也可以是一个python函数，输入是用户输入的原始信息，输出是符合要求的sora2视频指令。

---

## 智能体原理（人话版）
- 把你的原始文本先“洗一洗”：去掉多余空格、统一引号。
- 找出“谁在说话”和“说了啥”：识别角色名和“”“里面”的台词。
- 顺便看下气氛：有没有“压低声音”“哭丧着脸”“！”这类情绪线索。
- 给每句对话配一个镜头：机位（近景/中景）、表演描述、语气（英文）。
- 最终拼成一个 JSON 列表，每个元素就是一个镜头（shot）。

```mermaid
flowchart TD
  A[用户原始文本] --> B[文本标准化]
  B --> C[实体与对话抽取]
  C --> D[要素推断\n(机位/表演/语气)]
  D --> E[镜头构建]
  E --> F[输出JSON列表]
  F --> G[LLM提示词版本]
```

## 执行步骤（最小可用）
- 把文本丢给函数 `generate_sora2_instructions(text)`。
- 每一句台词都会生成一个镜头，默认时长 `"4"` 秒。
- 镜头里含角色、台词、语气、机位和表演描述，字段名固定。
- 结果是一个 JSON 数组，直接拿去喂 Sora2。

## 使用方法（Python）
- 文件位置：`src/sora2_agent.py`
- 快速示例：

```python
from src.sora2_agent import generate_sora2_instructions, to_json

raw = """
汤小团瞬间反应过来，压低声音道，“我们又穿越了！孟虎，你这乌鸦嘴，刚还在博物馆说想看看真的古代战场长什么样！”
“我哪知道摸一下锅的碎片，就能买到‘沉浸式体验’的VIP站票啊！” 孟虎哭丧着脸，揉着被硌得生疼的屁股，“这体验也太真实了吧？连个新手教程都没有！差评！”
"""

shots = generate_sora2_instructions(raw)
print(to_json(shots, ensure_ascii=False))
```

## 使用方法（LLM提示词）
- 文件位置：`prompts/sora2_llm_prompt.md`
- 把“用户原始文本”粘进去，模型会按模板直接输出 JSON 列表（无其他解释）。

---

## 10 条输入案例与预期结果（摘要）
为简洁起见，每例展示核心字段；`seconds` 默认均为 `"4"`。

1) 汤小团/孟虎（本页示例）
```json
[
  {
    "shot_id": "shot_01_tang_xiao_tuan",
    "description": "近景特写汤小团，他压低声音说：我们又穿越了！",
    "api_call": {"seconds": "4"},
    "cinematography": "Medium close-up (MCU) on '汤小团', shallow depth of field",
    "performance": "Leans in slightly, whispers urgently",
    "dialogue": {"character": "汤小团", "line": "我们又穿越了！孟虎，你这乌鸦嘴...", "tone": "urgent, emphatic"}
  },
  {
    "shot_id": "shot_02_meng_hu",
    "description": "中景跟拍孟虎，他哭丧着脸抱怨：这体验也太真实了吧？差评！",
    "api_call": {"seconds": "4"},
    "cinematography": "Medium shot, tracking '孟虎', handheld motion",
    "performance": "Face shows misery, shoulders slumped, complaining tone",
    "dialogue": {"character": "孟虎", "line": "这体验也太真实了吧？连个新手教程都没有！差评！", "tone": "whining, complaining"}
  }
]
```

2) 阿青/老周（紧张与安抚）
输入：阿青低声说，“我觉得有人跟着我们。” 老周平静回应，“别慌，先找路灯。”
```json
[
  {"shot_id":"shot_01_a_qing","dialogue":{"character":"阿青","line":"我觉得有人跟着我们。","tone":"hushed, cautious"}},
  {"shot_id":"shot_02_lao_zhou","dialogue":{"character":"老周","line":"别慌，先找路灯。","tone":"calm, steady"}}
]
```

3) 店员/顾客（抱怨）
输入：顾客抱怨道，“这咖啡太凉了！” 店员歉声说，“我马上给您换一杯。”
```json
[
  {"shot_id":"shot_01_gu_ke","dialogue":{"character":"顾客","line":"这咖啡太凉了！","tone":"urgent, emphatic"}},
  {"shot_id":"shot_02_dian_yuan","dialogue":{"character":"店员","line":"我马上给您换一杯。","tone":"calm, steady"}}
]
```

4) 教授/学生（疑问与回答）
输入：学生问，“这个公式怎么推导？” 教授解释，“先从边界条件入手。”
```json
[
  {"shot_id":"shot_01_xue_sheng","dialogue":{"character":"学生","line":"这个公式怎么推导？","tone":"neutral"}},
  {"shot_id":"shot_02_jiao_shou","dialogue":{"character":"教授","line":"先从边界条件入手。","tone":"calm, steady"}}
]
```

5) 小李/小王（争执）
输入：小李怒喊，“你又迟到了！” 小王委屈说，“路上堵车。”
```json
[
  {"shot_id":"shot_01_xiao_li","dialogue":{"character":"小李","line":"你又迟到了！","tone":"shouting, urgent"}},
  {"shot_id":"shot_02_xiao_wang","dialogue":{"character":"小王","line":"路上堵车。","tone":"neutral"}}
]
```

6) 船长/水手（指令）
输入：船长大喊，“升帆！” 水手回应，“是！”
```json
[
  {"shot_id":"shot_01_chuan_zhang","dialogue":{"character":"船长","line":"升帆！","tone":"shouting, urgent"}},
  {"shot_id":"shot_02_shui_shou","dialogue":{"character":"水手","line":"是！","tone":"urgent, emphatic"}}
]
```

7) 记者/摄影师（工作交流）
输入：记者说，“再靠近一点。” 摄影师回答，“光线有点暗。”
```json
[
  {"shot_id":"shot_01_ji_zhe","dialogue":{"character":"记者","line":"再靠近一点。","tone":"neutral"}},
  {"shot_id":"shot_02_she_ying_shi","dialogue":{"character":"摄影师","line":"光线有点暗。","tone":"neutral"}}
]
```

8) 医生/护士（紧急）
输入：医生急声说，“准备除颤！” 护士回答，“设备就位！”
```json
[
  {"shot_id":"shot_01_yi_sheng","dialogue":{"character":"医生","line":"准备除颤！","tone":"rapid, urgent"}},
  {"shot_id":"shot_02_hu_shi","dialogue":{"character":"护士","line":"设备就位！","tone":"urgent, emphatic"}}
]
```

9) 侦探/嫌疑人（试探）
输入：侦探低声问，“昨晚你去哪了？” 嫌疑人支吾，“我不记得。”
```json
[
  {"shot_id":"shot_01_zhen_tan","dialogue":{"character":"侦探","line":"昨晚你去哪了？","tone":"hushed, cautious"}},
  {"shot_id":"shot_02_xian_yi_ren","dialogue":{"character":"嫌疑人","line":"我不记得。","tone":"neutral"}}
]
```

10) 主持人/观众（互动）
输入：主持人热情地说，“准备好了吗？” 观众齐声答，“准备好了！”
```json
[
  {"shot_id":"shot_01_zhu_chi_ren","dialogue":{"character":"主持人","line":"准备好了吗？","tone":"calm, steady"}},
  {"shot_id":"shot_02_guan_zhong","dialogue":{"character":"观众","line":"准备好了！","tone":"urgent, emphatic"}}
]
```

---

## 注意
- 以上为摘要，实际生成会自动补全 `description`、`cinematography`、`performance` 等字段。
- `seconds` 可通过函数参数自定义（默认 `"4"` ）。

### 旁白（VO/画外音）扩展说明
- 识别触发词：`旁白`、`画外音`、`（旁白）`、`（画外音）`、`VO/V.O.`、`Narration`。
- 映射规则：
  - `dialogue.character` 设为 `旁白`。
  - `tone` 使用 `voice-over, reflective` 或相近表达。
  - `cinematography` 推荐 `B-roll / montage under narration (VO)`。

示例输入：
旁白：“那一夜，他们终于明白，命运从来不按套路出牌。”

示例输出（摘要）：
```json
[
  {
    "shot_id": "shot_01_narration",
    "description": "叠加旁白（画外音）：那一夜，他们终于明白，命运从来不按套路出牌。",
    "api_call": {"seconds": "4"},
    "cinematography": "B-roll / montage under narration (VO), soft dissolve transitions",
    "performance": "Narration: measured, reflective delivery",
    "dialogue": {"character": "旁白", "line": "那一夜，他们终于明白，命运从来不按套路出牌。", "tone": "voice-over, reflective"}
  }
]
```

### 画面外声音（O.S.）扩展说明
- 识别触发词：`O.S.`、`（画外）`、`门外`、`窗外`、`电话那头` 等。
- 映射规则：
  - 保持角色名不变。
  - `tone` 使用 `off-screen, audible` 或 `off-screen, urgent`。
  - `cinematography` 可用：`Medium shot on in-frame subject; off-screen voice (O.S.) audible`。

示例输入：
厨房里，李四正在切菜。门外妈妈喊：“菜要洗干净啊！”

示例输出（摘要）：
```json
[
  {
    "shot_id": "shot_01_li_si",
    "description": "画面外声音（O.S.）——妈妈：菜要洗干净啊！",
    "api_call": {"seconds": "4"},
    "cinematography": "Medium shot on in-frame subject; off-screen voice (O.S.) audible",
    "performance": "In-frame subject reacts subtly; off-screen voice carries scene",
    "dialogue": {"character": "妈妈", "line": "菜要洗干净啊！", "tone": "off-screen, urgent"}
  }
]
```
